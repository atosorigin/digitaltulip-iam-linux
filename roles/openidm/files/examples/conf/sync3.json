{
   "mappings":[
      {
         "name":"managedUser_systemCustomerdb",
         "source":"managed/user",
         "target":"system/customerdb/account",
         "correlationQuery":{
            "type":"text/javascript",
            "source":"var map = {'query': { 'Equals': {'field' : 'id','values' : [source._id]}}};map;"
         },
         "properties":[
            {
               "target":"id",
               "source":"_id"
            },
            {
               "target":"uid",
               "source":"userName"
            },
            {
               "target":"firstname",
               "source":"givenName"
            },
            {
               "target":"lastname",
               "source":"familyName"
            },
            {
               "source":"userrole",
               "target":"userrole",
               "default":"customer"
            },
            {
               "source":"email",
               "target":"email"
            },
            {
               "source":"altEmail",
               "target":"altEmail"
            }
         ],
         "policies":[
            {
               "situation":"CONFIRMED",
               "action":"UPDATE"
            },
            {
               "situation":"FOUND",
               "action":"IGNORE"
            },
            {
               "situation":"ABSENT",
               "action":"CREATE"
            },
            {
               "situation":"AMBIGUOUS",
               "action":"IGNORE"
            },
            {
               "situation":"MISSING",
               "action":"DELETE"
            },
            {
               "situation":"SOURCE_MISSING",
               "action":"DELETE"
            },
            {
               "situation":"UNQUALIFIED",
               "action":"IGNORE"
            },
            {
               "situation":"UNASSIGNED",
               "action":"IGNORE"
            }
         ]
      },
      {
         "name":"managedUser_systemMobiledb",
         "source":"managed/user",
         "target":"system/mobiledb/account",
         "correlationQuery":{
            "type":"text/javascript",
            "source":"var map = {'query': { 'Equals': {'field' : 'id','values' : [source._id]}}};map;"
         },
         "validSource":{
            "type":"text/javascript",
            "source":"source.userrole == 'mobile'"
         },
         "properties":[
            {
               "target":"id",
               "source":"_id"
            },
            {
               "target":"uid",
               "source":"userName"
            },
            {
               "target":"firstname",
               "source":"givenName"
            },
            {
               "target":"lastname",
               "source":"familyName"
            },
            {
               "source":"userrole",
               "target":"userrole",
               "default":"customer"
            },
            {
               "source":"email",
               "target":"email"
            },
            {
               "source":"altEmail",
               "target":"altEmail"
            }
         ],
         "policies":[
            {
               "situation":"CONFIRMED",
               "action":"UPDATE"
            },
            {
               "situation":"FOUND",
               "action":"IGNORE"
            },
            {
               "situation":"ABSENT",
               "action":"CREATE"
            },
            {
               "situation":"AMBIGUOUS",
               "action":"IGNORE"
            },
            {
               "situation":"MISSING",
               "action":"DELETE"
            },
            {
               "situation":"SOURCE_MISSING",
               "action":"DELETE"
            },
            {
               "situation":"UNQUALIFIED",
               "action":"IGNORE"
            },
            {
               "situation":"UNASSIGNED",
               "action":"IGNORE"
            }
         ]
      },
      {
         "name":"managedUser_systemLdapAccounts",
         "source":"managed/user",
         "target":"system/ldap/account",
         "correlationQuery":{
            "type":"text/javascript",
            "source":"var map = {'query': { 'Equals': {'field' : 'uid','values' : [source.userName]}}};map;"
         },
         "properties":[
            {
               "source":"givenName",
               "target":"givenName"
            },
            {
               "source":"familyName",
               "target":"sn"
            },
            {
               "source":"displayName",
               "target":"cn"
            },
            {
               "source":"userName",
               "target":"uid"
            },
            {
               "source":"description",
               "target":"description"
            },
            {
               "source":"email",
               "target":"mail"
            },
            {
               "source":"password",
               "target":"userPassword"
            },
            {
               "source":"ldapGroups",
               "target":"ldapGroups"
            }
         ],
         "onCreate":{
            "type":"text/javascript",
            "source":"target.dn = 'uid=' + source.userName + ',ou=People,dc=example,dc=com'; target.userPassword = openidm.decrypt(source.password);"
         },
         "onUpdate":{
            "type":"text/javascript",
            "source":"target.userPassword = openidm.decrypt(source.password);"
         },
         "policies":[
            {
               "situation":"CONFIRMED",
               "action":"UPDATE"
            },
            {
               "situation":"FOUND",
               "action":"LINK"
            },
            {
               "situation":"ABSENT",
               "action":"CREATE"
            },
            {
               "situation":"AMBIGUOUS",
               "action":"IGNORE"
            },
            {
               "situation":"MISSING",
               "action":"CREATE"
            },
            {
               "situation":"SOURCE_MISSING",
               "action":"DELETE"
            },
            {
               "situation":"UNQUALIFIED",
               "action":"IGNORE"
            },
            {
               "situation":"UNASSIGNED",
               "action":"IGNORE"
            }
         ]
      }
   ]
}